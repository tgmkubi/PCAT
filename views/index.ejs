<%-include('partials/_header.ejs')-%>

  <body>
    <div class="tm-page-wrap mx-auto">
      <div class="position-relative">

        <%-include('partials/_navigation.ejs')-%>

        <div class="tm-welcome-container text-center text-white">
          <div class="tm-welcome-container-inner">
            <p class="tm-welcome-text mb-1 text-white">
              Photo Catalog is brought to you by Kubilay Uysal.
            </p>
            <p class="tm-welcome-text mb-5 text-white">
              Explore the nature
            </p>
            <a
              href="#content"
              class="btn tm-btn-animate tm-btn-cta tm-icon-down"
            >
              <span>Discover</span>
            </a>
          </div>
        </div>

        <div id="tm-video-container">
          <video autoplay muted loop id="tm-video">
            <!-- <source src="video/night-drive.mp4" type="video/mp4" /> -->
            <source src="video/mountain-drive.mp4" type="video/mp4" />
          </video>
        </div>

        <i id="tm-video-control-button" class="fas fa-pause"></i>
      </div>

      <div class="container-fluid">
        <div id="content" class="mx-auto tm-content-container">
          <main>
            <div class="row">
              <div class="col-12">
                <h2 class="tm-page-title mb-4 mt-4">Our Photo Catalog</h2>
                <div class="tm-categories-container mb-5">
                  <h3 class="tm-text-primary tm-categories-text">
                    Categories:
                  </h3>
                  <ul class="nav tm-category-list">
                    <li class="nav-item tm-category-item">
                      <a href="#" class="nav-link tm-category-link active"
                        >All</a
                      >
                    </li>
                    <li class="nav-item tm-category-item">
                      <a href="#" class="nav-link tm-category-link"
                        >Cars</a
                      >
                    </li>
                    <li class="nav-item tm-category-item">
                      <a href="#" class="nav-link tm-category-link">Nature</a>
                    </li>
                    <li class="nav-item tm-category-item">
                      <a href="#" class="nav-link tm-category-link">Actions</a>
                    </li>
                    <li class="nav-item tm-category-item">
                      <a href="#" class="nav-link tm-category-link">Featured</a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="row tm-catalog-item-list">

              <% for (let i = 0; i < photos.length; i++) { %>

              <div class="col-lg-4 col-md-6 col-sm-12 tm-catalog-item">
                <div class="position-relative tm-thumbnail-container">
                  <img
                    src=<%= photos[i].image %>
                    alt="Image"
                    class="img-fluid tm-catalog-item-img"
                    style="min-height: 300px;"
                  />
                  <a
                    href="/photos/<%= photos[i]._id %>"
                    class="position-absolute tm-img-overlay"
                  >
                    <i class="fas fa-play tm-overlay-icon"></i>
                  </a>
                </div>
                <div class="p-4 tm-bg-gray tm-catalog-item-description">
                  <h3 class="tm-text-primary mb-3 tm-catalog-item-title">
                    <%= photos[i].title.slice(0, 50) %>
                  </h3>
                  <p class="tm-catalog-item-text">
                    <%= photos[i].description.slice(0, 100) %>...<a href="/photos/<%= photos[i]._id%>" style="color: blue;">continue to read</a>
                  </p>
                </div>
              </div>
              
              <% } %>
            </div>

            <!-- Catalog Paging Buttons -->
            <div style="display: flex; justify-content: center;">
              <ul class="nav tm-paging-links">
                <% const previousPageLink = page == 1 ? null : `<li class="nav-item"><a href="?page=${parseInt(page) - 1}" class="nav-link tm-paging-link"><</a></li>`%>
                <%- previousPageLink %>
                <% for(let i = 1; i <= totalPage; i++) { %>
                  <% const isActive = i == page ? "active" : null;%>
                  <li class="nav-item <%= isActive %>">
                    <a href="?page=<%= i %>" class="nav-link tm-paging-link"><%= i %></a>
                  </li>
                <% } %>
                <% const nextPageLink = page == totalPage ? null : `<li class="nav-item"><a href="?page=${parseInt(page) + 1}" class="nav-link tm-paging-link">></a></li>`%>
                <%- nextPageLink %>
              </ul>
            </div>
          </main>

    <%-include("partials/_footer.ejs")-%>

    <script>
      function setVideoSize() {
        const vidWidth = 1920;
        const vidHeight = 1080;
        let windowWidth = window.innerWidth;
        let newVidWidth = windowWidth;
        let newVidHeight = (windowWidth * vidHeight) / vidWidth;
        let marginLeft = 0;
        let marginTop = 0;

        if (newVidHeight < 500) {
          newVidHeight = 500;
          newVidWidth = (newVidHeight * vidWidth) / vidHeight;
        }

        if (newVidWidth > windowWidth) {
          marginLeft = -((newVidWidth - windowWidth) / 2);
        }

        if (newVidHeight > 720) {
          marginTop = -((newVidHeight - $('#tm-video-container').height()) / 2);
        }

        const tmVideo = $('#tm-video');

        tmVideo.css('width', newVidWidth);
        tmVideo.css('height', newVidHeight);
        tmVideo.css('margin-left', marginLeft);
        tmVideo.css('margin-top', marginTop);
      }

      $(document).ready(function () {
        /************** Video background *********/

        setVideoSize();

        // Set video background size based on window size
        let timeout;
        window.onresize = function () {
          clearTimeout(timeout);
          timeout = setTimeout(setVideoSize, 100);
        };

        // Play/Pause button for video background
        const btn = $('#tm-video-control-button');

        btn.on('click', function (e) {
          const video = document.getElementById('tm-video');
          $(this).removeClass();

          if (video.paused) {
            video.play();
            $(this).addClass('fas fa-pause');
          } else {
            video.pause();
            $(this).addClass('fas fa-play');
          }
        });
      });
    </script>
  </body>
</html>
